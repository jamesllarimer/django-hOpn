{# templates/registration/registration_management.html #}
{% extends 'base.html' %}
{% load registration_tags %}
{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- League Filter -->
    <div class="mb-8">
        <form method="get" class="flex items-center space-x-4">
            <select name="league" class="rounded-lg border-gray-300">
                <option value="">All Leagues</option>
                {% for league in leagues %}
                    <option value="{{ league.id }}" {% if selected_league == league.id|stringformat:"s" %}selected{% endif %}>
                        {{ league.name }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                Filter
            </button>
        </form>
    </div>

    <!-- Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white p-4 rounded-lg shadow">
            <div class="text-xl font-bold">{{ stats.total_registrations }}</div>
            <div class="text-gray-600">Total Registrations</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow">
            <div class="text-xl font-bold">{{ stats.total_free_agents }}</div>
            <div class="text-gray-600">Free Agents</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow">
            <div class="text-xl font-bold">{{ stats.divisions_count }}</div>
            <div class="text-gray-600">Divisions</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow">
            <div class="text-xl font-bold">{{ stats.teams_count }}</div>
            <div class="text-gray-600">Teams</div>
        </div>
    </div>

    <!-- Registrations by Division -->
    {% for division, teams in organized_data.items %}
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4">{{ division.name }}</h2>
            
            <!-- Free Agents in this division -->
            {% if free_agents|get:division %}
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-2">Free Agents</h3>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for registration in free_agents|get:division %}
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">{{ registration.player.get_full_name }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">{{ registration.player.email }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">{{ registration.player.phone_number }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                Free Agent
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <a href="#" class="text-indigo-600 hover:text-indigo-900">Assign Team</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endif %}

            <!-- Teams in this division -->
            {% for team, registrations in teams.items %}
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-2">{{ team.name }}</h3>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jersey #</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for registration in registrations %}
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">{{ registration.player.get_full_name }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">{{ registration.player.email }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">{{ registration.player.phone_number }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">{{ registration.player.jersey_number|default:'-' }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <a href="#" class="text-indigo-600 hover:text-indigo-900">Edit</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% empty %}
        <div class="text-center py-8">
            <p class="text-gray-500">No registrations found.</p>
        </div>
    {% endfor %}
</div>
{% endblock %}